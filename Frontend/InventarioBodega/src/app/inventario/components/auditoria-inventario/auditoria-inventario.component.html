<div class="auditoria-container">

    <!-- ====== Resumen Tarjetas ====== -->
    <div class="resumen-inventario">
        <div class="card" *ngFor="let item of resumenInventario" [ngClass]="item.colorClass">
            <h4>{{item.titulo}}</h4>
            <p>Cantidad: {{item.cantidad}}</p>
            <p>Peso: {{item.peso}}</p>
        </div>
    </div>

    <!-- ====== Mini Reportes ====== -->
    <div class="mini-reportes-grid">
        <mat-card>
            <mat-card-title>Totales por Tipo</mat-card-title>
            <mat-card-content>
                <table class="mini-tabla">
                    <tr *ngFor="let t of totalesPorTipo">
                        <td>{{ t.tipo }}</td>
                        <td>{{ t.total }}</td>
                    </tr>
                </table>
            </mat-card-content>
        </mat-card>

        <mat-card>
            <mat-card-title>Referencias más movidas</mat-card-title>
            <mat-card-content>
                <table class="mini-tabla">
                    <tr *ngFor="let r of referenciasMasMovidas">
                        <td>{{ r.referencia }}</td>
                        <td>{{ r.total }}</td>
                    </tr>
                </table>
            </mat-card-content>
        </mat-card>

        <mat-card>
            <mat-card-title>Usuarios más activos</mat-card-title>
            <mat-card-content>
                <table class="mini-tabla">
                    <tr *ngFor="let u of usuariosMasActivos">
                        <td>{{ u.usuario }}</td>
                        <td>{{ u.total }}</td>
                    </tr>
                </table>
            </mat-card-content>
        </mat-card>
    </div>

    <!-- ====== Filtros ====== -->
    <mat-card class="filtro-card">
        <mat-form-field appearance="outline">
            <mat-label>Rango de fechas</mat-label>
            <mat-date-range-input [rangePicker]="picker" (dateChange)="rangoCambiado($event)">
                <input matStartDate placeholder="Fecha inicio" [(ngModel)]="fechaInicio">
                <input matEndDate placeholder="Fecha fin" [(ngModel)]="fechaFin">
            </mat-date-range-input>
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-date-range-picker #picker></mat-date-range-picker>
        </mat-form-field>
    </mat-card>

    <!-- ====== Tabla Movimientos ====== -->
    <mat-card class="tabla-card">
        <div class="tabla-header">
            <h3>Histórico de Movimientos</h3>
            <mat-form-field appearance="outline" class="filtro">
                <mat-label>Buscar</mat-label>
                <input matInput (keyup)="applyFilter($event)">
            </mat-form-field>
        </div>

        <div class="tabla-container">
            <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z2">

                <ng-container matColumnDef="referencia">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Referencia</th>
                    <td mat-cell *matCellDef="let element">{{ element.referencia }}</td>
                </ng-container>

                <ng-container matColumnDef="tipo">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Tipo</th>
                    <td mat-cell *matCellDef="let element">
                        <span [ngClass]="element.tipo === 'Entrada' ? 'entrada' : 'salida'">
                            {{ element.tipo }}
                        </span>
                    </td>
                </ng-container>

                <ng-container matColumnDef="peso">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Peso (Kg)</th>
                    <td mat-cell *matCellDef="let element">{{ element.peso }}</td>
                </ng-container>

                <ng-container matColumnDef="fecha">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Fecha</th>
                    <td mat-cell *matCellDef="let element">{{ element.fecha | date:'short' }}</td>
                </ng-container>

                <ng-container matColumnDef="usuario">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Usuario</th>
                    <td mat-cell *matCellDef="let element">{{ element.usuario }}</td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>

            <mat-paginator [pageSize]="10" showFirstLastButtons></mat-paginator>
        </div>
    </mat-card>

</div>